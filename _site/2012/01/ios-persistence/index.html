<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="海涛" />
    <title>iOS持久化 | 海涛</title>
    <link href="data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAD/APr59wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIiIiIiIiAAAiIiIiIiIAACIiIiIiIgERERERERIiAREREREREiIBERERERESIgERIiIiERIiAREiIiIREiIBESIhERESIgERIiERERIiAREiIiIiIiIBESIiIiIiIgERIiIiIiIiAREREREREAABEREREREQAAERERERERAADgAQAA4AEAAOABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAA8AAAAPAAAADwAA" rel="icon" type="image/x-icon" />
    <link href="//feed/" rel="alternate" title="海涛" type="application/atom+xml" />
    
    <link rel="stylesheet" href="//media/css/highlight.css">
    <link href='//media/webfonts/ss-social.css' rel='stylesheet'>
    <link href='//media/webfonts/ss-standard.css' rel='stylesheet'>
    <link href="//media/css/screen.css" rel="stylesheet">

    <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
  </head>
  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <div class="buttons">
          <a href="/categories" class="ss-icon" title="Go to homepage">home</a>
          <a href="/" class="ss-icon" title="Category" >list</a>
          <a href="/tags" class="ss-icon" title="Tag Cloud" >tags</a>
          <a href="/guestbook" class="ss-icon" title="Guest Book" >talk</a>
          <a href="/about" class="ss-icon" title="About" >user</a>
          <a href="/feed" class="ss-icon" title="Subscribe by RSS" >rss</a>
        </div>
        <h1>iOS持久化</h1>
        </header>
        <hr>
        <article class="content">
        <section class="post">
<ul>
<li>文件系统</li>
<li>归档和序列化</li>
<li>数据库</li>
</ul>


<hr />

<h2>1.文件系统</h2>

<p>不管是Mac OS X 还是iOS的文件系统都是建立在UNIX文件系统基础之上的。</p>

<h3>1.1 沙盒模型</h3>

<p>在iOS中，一个App的读写权限只局限于自己的沙盒目录中。</p>

<blockquote><p><strong>沙盒模型到底有哪些好处呢?</strong><br/>
安全：别的App无法修改你的程序或数据<br/>
保护隐私：别的App无法读取你的程序和数据<br/>
方便删除：因为一个App所有产生的内容都在自己的沙盒中，所以删除App只需要将沙盒删除就可以彻底删除程序了</p></blockquote>

<p> iOS App沙盒中的目录</p>

<ul>
<li>App Bundle ,如xxx.app 其实是一个目录，里面有app本身的二进制数据以及资源文件</li>
<li>Documents, 存放程序产生的文档数据</li>
<li>Library , 下面默认包含下面两个目录 Caches Preferences</li>
<li>tmp, 临时文件目录</li>
</ul>


<p>如果我们想在程序中获取上面某个目录的路径，应该如何实现呢？
下面就讲讲路径的获取，
通过<code>NSPathUtilities.h</code>中的<code>NSSearchPathForDirectoriesInDomains</code>函数，我们便可以获取我们想要的路径。
此函数具体声明如下:</p>

<blockquote><p>NSArray *NSSearchPathForDirectoriesInDomains(NSSearchPathDirectory directory, NSSearchPathDomainMask domainMask, BOOL expandTilde); <br/>
<strong>directory</strong> 目录类型 比如Documents目录 就是NSDocumentDirectory <br/>
<strong>domainMask</strong> 在iOS的程序中这个取NSUserDomainMask <br/>
<strong>expandTilde</strong> YES，表示将~展开成完整路径</p></blockquote>

<p>注意函数返回的类型为数组，在iOS中一般这个数组中只包含一个元素，所以直接取lastObject即可。</p>

<h3>1.2 NSFileManager</h3>

<p>NSFileManager提供一个类方法获得一个单例。</p>

<div class="highlight"><pre><code class="objc"><span class="cm">/* Returns the default singleton instance.*/</span>
<span class="k">+</span> <span class="p">(</span><span class="n">NSFileManager</span> <span class="o">*</span><span class="p">)</span><span class="nf">defaultManager</span><span class="p">;</span>
</code></pre></div>


<p>下面罗列了NSFileManager的常用方法</p>

<ul>
<li>新建目录</li>
</ul>


<div class="highlight"><pre><code class="objc"><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">createDirectoryAtPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">withIntermediateDirectories:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">createIntermediates</span> <span class="nf">attributes:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">attributes</span> <span class="nf">error:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
</code></pre></div>


<p>createIntermediates这个参数一般为YES，表示如果目录路径中间的某个目录不存在则创建之,如果是NO的话，则要保证所创建目录的父目录都必须已经存在</p>

<ul>
<li>获取目录下的所有文件</li>
</ul>


<div class="highlight"><pre><code class="objc"><span class="k">-</span> <span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">contentsOfDirectoryAtPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">error:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
</code></pre></div>


<p>如果目录为空，则返回空数组</p>

<ul>
<li>其他的一些方法</li>
</ul>


<div class="highlight"><pre><code class="objc"><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">copyItemAtPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">srcPath</span> <span class="nf">toPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">dstPath</span> <span class="nf">error:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">moveItemAtPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">srcPath</span> <span class="nf">toPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">dstPath</span> <span class="nf">error:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">linkItemAtPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">srcPath</span> <span class="nf">toPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">dstPath</span> <span class="nf">error:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">removeItemAtPath:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">error:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
</code></pre></div>


<p>更多的可以查看文档 <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/Reference/Reference.html">NSFileManager Class Reference</a>。</p>

<p>在实际项目中，我们一般会写一个工具类来负责项目中所有的路径操作。</p>

<h2>2. 归档（Archives） 和 序列化（Serializations）</h2>

<p>我们经常听到“序列化”，“反序列化”这样的字眼，其实“序列化”的意思就是将对象转换成字节流以便保存或传输，“反序列化”便是一个相反的过程，从字节流转到对象。</p>

<p>在这节中涉及到一种文件类型plist，plist就是Property List 的缩写,即所谓的属性列表，属性列表有两种数据格式，一种是XML的，方便阅读和编辑；另一种是二进制的，节省存储空间，以及提高效率。</p>

<p>在Objective-C中这个对象和字节流的互转分成两类:</p>

<ul>
<li><strong>归档</strong> 普通自定义对象和字节流之间的转换</li>
<li><strong>序列化</strong> 某些特定类型（NSDictionary, NSArray, NSString, NSDate, NSNumber，NSData）的数据和字节流之间(通常将其保存为plist文件)的转换</li>
</ul>


<p>不过本质上讲上述两种都是对象图(<a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Archiving/Articles/objectgraphs.html#//apple_ref/doc/uid/20001293-CJBDFIBI">Object Graph</a>)和字节流之间的转换.
Apple关于序列化和归档的编程指南: <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Archiving/Archiving.html">Archives and Serializations Programming Guide</a> 。</p>

<h3>2.1 归档</h3>

<p>如果我们需要将自定义的一个对象保存到文件，应该如何做呢？ <br/>
这里引入两个东西：一个是NSCoding协议 ；另一个是NSKeyedArchiver，NSKeyedArchiver其实继承于NSCoder，可以以键值对的方式将对象的属性进行序列化和反序列化。    <br/>
具体的过程可以这样描述 <strong>通过NSKeyedArchiver 可以将实现了NSCoding协议的对象 和 字节流 相互转换</strong> 。</p>

<p>像一些框架中的数据类型如NSDictionary,NSArray,NSString... 都已经实现了NSCoding协议，所以可以直接对他们进行归档操作。</p>

<p>这里来一个比较完整的例子，一个Address类，一个User类，User类下有个Address类型的属性。</p>

<p><strong>Address类</strong></p>

<div class="highlight"><pre><code class="objc"><span class="k">@interface</span> <span class="nc">Address</span> : <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">NSCoding</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">country</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">city</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">country</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">city</span><span class="p">;</span>
<span class="k">@end</span>
<span class="c1">//////////////////////////////////////////////////////</span>
<span class="cp">#import &quot;Address.h&quot;</span>

<span class="k">@implementation</span> <span class="nc">Address</span>
<span class="k">@synthesize</span> <span class="n">country</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">city</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">encodeWithCoder:</span><span class="p">(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aCoder</span><span class="p">{</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="n">encodeObject</span><span class="o">:</span><span class="n">country</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;country&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="n">encodeObject</span><span class="o">:</span><span class="n">city</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;city&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithCoder:</span><span class="p">(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aDecoder</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="n">setCountry</span><span class="o">:</span><span class="p">[</span><span class="n">aDecoder</span> <span class="n">decodeObjectForKey</span><span class="o">:</span><span class="s">@&quot;country&quot;</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">self</span> <span class="n">setCity</span><span class="o">:</span><span class="p">[</span><span class="n">aDecoder</span> <span class="n">decodeObjectForKey</span><span class="o">:</span><span class="s">@&quot;city&quot;</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>


<p><strong>User类</strong></p>

<div class="highlight"><pre><code class="objc"><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
<span class="cp">#import &quot;Address.h&quot;</span>
<span class="k">@interface</span> <span class="nc">User</span> : <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">NSCoding</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_name</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_password</span><span class="p">;</span>

    <span class="n">Address</span> <span class="o">*</span><span class="n">_address</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">password</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">retain</span><span class="p">)</span> <span class="n">Address</span> <span class="o">*</span><span class="n">address</span><span class="p">;</span>

<span class="k">@end</span>
<span class="c1">/////////////////////////////////////////////////////////</span>
<span class="cp">#import &quot;User.h&quot;</span>

<span class="k">@implementation</span> <span class="nc">User</span>
<span class="k">@synthesize</span> <span class="n">name</span> <span class="o">=</span> <span class="n">_name</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">password</span> <span class="o">=</span> <span class="n">_password</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">address</span> <span class="o">=</span> <span class="n">_address</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">encodeWithCoder:</span><span class="p">(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aCoder</span><span class="p">{</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="n">encodeObject</span><span class="o">:</span><span class="n">_name</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;name&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="n">encodeObject</span><span class="o">:</span><span class="n">_password</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;password&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">aCoder</span> <span class="n">encodeObject</span><span class="o">:</span><span class="n">_address</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;address&quot;</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithCoder:</span><span class="p">(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">aDecoder</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="n">setName</span><span class="o">:</span><span class="p">[</span><span class="n">aDecoder</span> <span class="n">decodeObjectForKey</span><span class="o">:</span><span class="s">@&quot;name&quot;</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">self</span> <span class="n">setPassword</span><span class="o">:</span><span class="p">[</span><span class="n">aDecoder</span> <span class="n">decodeObjectForKey</span><span class="o">:</span><span class="s">@&quot;password&quot;</span><span class="p">]];</span>
        <span class="p">[</span><span class="n">self</span> <span class="n">setAddress</span><span class="o">:</span><span class="p">[</span><span class="n">aDecoder</span> <span class="n">decodeObjectForKey</span><span class="o">:</span><span class="s">@&quot;address&quot;</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></div>


<p><strong>使用示例</strong></p>

<div class="highlight"><pre><code class="objc"><span class="n">Address</span> <span class="o">*</span><span class="n">myAddress</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">Address</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">]</span> <span class="n">autorelease</span><span class="p">];</span>
<span class="n">myAddress</span><span class="p">.</span><span class="n">country</span> <span class="o">=</span> <span class="s">@&quot;中国&quot;</span><span class="p">;</span>
<span class="n">myAddress</span><span class="p">.</span><span class="n">city</span> <span class="o">=</span> <span class="s">@&quot;杭州&quot;</span><span class="p">;</span>
 
<span class="n">User</span> <span class="o">*</span><span class="n">user</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">User</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">]</span> <span class="n">autorelease</span><span class="p">];</span>
<span class="n">user</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">@&quot;卢克&quot;</span><span class="p">;</span>
<span class="n">user</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="s">@&quot;lukejin&quot;</span><span class="p">;</span>
<span class="n">user</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">myAddress</span><span class="p">;</span>

<span class="p">[</span><span class="n">NSKeyedArchiver</span> <span class="n">archiveRootObject</span><span class="o">:</span><span class="n">user</span> <span class="n">toFile</span><span class="o">:</span><span class="s">@&quot;/Users/Luke/Desktop/user&quot;</span><span class="p">];</span>

<span class="kt">id</span> <span class="n">object</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSKeyedUnarchiver</span> <span class="n">unarchiveObjectWithFile</span><span class="o">:</span><span class="s">@&quot;/Users/Luke/Desktop/user&quot;</span><span class="p">];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Object Class : %@&quot;</span><span class="p">,[</span><span class="n">object</span> <span class="n">class</span><span class="p">]);</span>
</code></pre></div>


<p>通过查看文件内容可以发现，保存的是plist的二进制数据格式。
转成XML可以看到如下内容:</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/ PropertyList-1.0.dtd&quot;&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>$archiver<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>NSKeyedArchiver<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>$objects<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;array&gt;</span>
        <span class="nt">&lt;string&gt;</span>$null<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>$class<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;dict&gt;</span>
                <span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
                <span class="nt">&lt;integer&gt;</span>8<span class="nt">&lt;/integer&gt;</span>
            <span class="nt">&lt;/dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>address<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;dict&gt;</span>
                <span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
                <span class="nt">&lt;integer&gt;</span>4<span class="nt">&lt;/integer&gt;</span>
            <span class="nt">&lt;/dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>name<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;dict&gt;</span>
                <span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
                <span class="nt">&lt;integer&gt;</span>2<span class="nt">&lt;/integer&gt;</span>
            <span class="nt">&lt;/dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>password<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;dict&gt;</span>
                <span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
                <span class="nt">&lt;integer&gt;</span>3<span class="nt">&lt;/integer&gt;</span>
            <span class="nt">&lt;/dict&gt;</span>
        <span class="nt">&lt;/dict&gt;</span>
        <span class="nt">&lt;string&gt;</span>卢克<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>lukejin<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>$class<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;dict&gt;</span>
                <span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
                <span class="nt">&lt;integer&gt;</span>7<span class="nt">&lt;/integer&gt;</span>
            <span class="nt">&lt;/dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>city<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;dict&gt;</span>
                <span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
                <span class="nt">&lt;integer&gt;</span>6<span class="nt">&lt;/integer&gt;</span>
            <span class="nt">&lt;/dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>country<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;dict&gt;</span>
                <span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
                <span class="nt">&lt;integer&gt;</span>5<span class="nt">&lt;/integer&gt;</span>
            <span class="nt">&lt;/dict&gt;</span>
        <span class="nt">&lt;/dict&gt;</span>
        <span class="nt">&lt;string&gt;</span>中国<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>杭州<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>$classes<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;array&gt;</span>
                <span class="nt">&lt;string&gt;</span>Address<span class="nt">&lt;/string&gt;</span>
                <span class="nt">&lt;string&gt;</span>NSObject<span class="nt">&lt;/string&gt;</span>
            <span class="nt">&lt;/array&gt;</span>
            <span class="nt">&lt;key&gt;</span>$classname<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;string&gt;</span>Address<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;/dict&gt;</span>
        <span class="nt">&lt;dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>$classes<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;array&gt;</span>
                <span class="nt">&lt;string&gt;</span>User<span class="nt">&lt;/string&gt;</span>
                <span class="nt">&lt;string&gt;</span>NSObject<span class="nt">&lt;/string&gt;</span>
            <span class="nt">&lt;/array&gt;</span>
            <span class="nt">&lt;key&gt;</span>$classname<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;string&gt;</span>User<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;/dict&gt;</span>
    <span class="nt">&lt;/array&gt;</span>
    <span class="nt">&lt;key&gt;</span>$top<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;dict&gt;</span>
        <span class="nt">&lt;key&gt;</span>root<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;dict&gt;</span>
            <span class="nt">&lt;key&gt;</span>CF$UID<span class="nt">&lt;/key&gt;</span>
            <span class="nt">&lt;integer&gt;</span>1<span class="nt">&lt;/integer&gt;</span>
        <span class="nt">&lt;/dict&gt;</span>
    <span class="nt">&lt;/dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>$version<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>100000<span class="nt">&lt;/integer&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</code></pre></div>


<h3>2.2 序列化</h3>

<p>在实际的项目中，我们一般是将NSDictionary或NSArray的对象保存到文件或者从文件读取成对象。
当然这种只是适用于数据量不是很大的应用场景。
NSDictionary和NSArray 都有一个写入文件的方法</p>

<div class="highlight"><pre><code class="objc"> 
<span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">writeToFile:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">atomically:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">useAuxiliaryFile</span><span class="p">;</span>
</code></pre></div>


<p>NSDictionary和NSArray会直接写成plist文件。</p>

<h4>2.2.1 序列化的方式</h4>

<p>序列化可以通过两种途径来进行</p>

<h5>使用数据对象自带的方法</h5>

<p>写文件</p>

<div class="highlight"><pre><code class="objc"> 
<span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">dataDictionary</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">NSMutableDictionary</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">]</span> <span class="n">autorelease</span><span class="p">];</span>
 <span class="p">[</span><span class="n">dataDictionary</span> <span class="n">setValue</span><span class="o">:</span><span class="p">[</span><span class="n">NSNumber</span> <span class="n">numberWithInt</span><span class="o">:</span><span class="mi">222</span><span class="p">]</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;intNumber&quot;</span><span class="p">];</span>
 <span class="p">[</span><span class="n">dataDictionary</span> <span class="n">setValue</span><span class="o">:</span><span class="p">[</span><span class="n">NSArray</span> <span class="n">arrayWithObjects</span><span class="o">:</span><span class="s">@&quot;1&quot;</span><span class="p">,</span><span class="s">@&quot;2&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">]</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;testArray&quot;</span><span class="p">];</span>
 <span class="p">[</span><span class="n">dataDictionary</span> <span class="n">writeToFile</span><span class="o">:</span><span class="s">@&quot;/Users/Luke/Desktop/test.plist&quot;</span> <span class="n">atomically</span><span class="o">:</span><span class="nb">YES</span><span class="p">];</span>
</code></pre></div>


<p>写完的文件内容如下:</p>

<div class="highlight"><pre><code class="xml">  
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>intNumber<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>222<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>testArray<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;array&gt;</span>
        <span class="nt">&lt;string&gt;</span>1<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>2<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/array&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</code></pre></div>


<p>   从文件读取</p>

<div class="highlight"><pre><code class="objc">    
<span class="n">NSDictionary</span> <span class="o">*</span><span class="n">dictionaryFromFile</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDictionary</span> <span class="n">dictionaryWithContentsOfFile</span><span class="o">:</span><span class="s">@&quot;/Users/Luke/Desktop/test.plist&quot;</span><span class="p">];</span>
</code></pre></div>


<h5>使用NSPropertyListSerialization类</h5>

<p>通过NSPropertyListSerialization类可以将数据对象直接转成NSData或者直接写到文件或者流中去.</p>

<div class="highlight"><pre><code class="objc">    
<span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">dataDictionary</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">NSMutableDictionary</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">]</span> <span class="n">autorelease</span><span class="p">];</span>
<span class="p">[</span><span class="n">dataDictionary</span> <span class="n">setValue</span><span class="o">:</span><span class="p">[</span><span class="n">NSNumber</span> <span class="n">numberWithInt</span><span class="o">:</span><span class="mi">222</span><span class="p">]</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;intNumber&quot;</span><span class="p">];</span>
<span class="p">[</span><span class="n">dataDictionary</span> <span class="n">setValue</span><span class="o">:</span><span class="p">[</span><span class="n">NSArray</span> <span class="n">arrayWithObjects</span><span class="o">:</span><span class="s">@&quot;1&quot;</span><span class="p">,</span><span class="s">@&quot;2&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">]</span> <span class="n">forKey</span><span class="o">:</span><span class="s">@&quot;testArray&quot;</span><span class="p">];</span>

<span class="n">NSString</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
<span class="n">NSData</span> <span class="o">*</span><span class="n">xmlData</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSPropertyListSerialization</span> <span class="n">dataFromPropertyList</span><span class="o">:</span><span class="n">dataDictionary</span>
                                                           <span class="nl">format:</span><span class="n">NSPropertyListXMLFormat_v1_0</span>
                                                 <span class="nl">errorDescription:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="n">xmlData</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;No error creating XML data.&quot;</span><span class="p">);</span>
    <span class="p">[</span><span class="n">xmlData</span> <span class="n">writeToFile</span><span class="o">:</span><span class="s">@&quot;/Users/Luke/Desktop/test2.plist&quot;</span> <span class="n">atomically</span><span class="o">:</span><span class="nb">YES</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;error:%@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
        <span class="p">[</span><span class="n">error</span> <span class="n">release</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>读取</p>

<div class="highlight"><pre><code class="objc">    
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">dictionaryFromFile</span> <span class="o">=</span> <span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)[</span><span class="n">NSPropertyListSerialization</span> 
                                                       <span class="n">propertyListWithData</span><span class="o">:</span><span class="p">[</span><span class="n">NSData</span> <span class="n">dataWithContentsOfFile</span><span class="o">:</span><span class="s">@&quot;/Users/Luke/Desktop/test2.plist&quot;</span><span class="p">]</span> 
                                                        <span class="n">options</span><span class="o">:</span><span class="mi">0</span>
                                                        <span class="nl">format:</span><span class="nb">NULL</span>
                                                        <span class="nl">error:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>
</code></pre></div>


<h4>2.2.2 User Defaults</h4>

<p>User Defaults 顾名思义就是一个用户为系统以及程序设置的默认值。每个用户都有自己的一套数据，用户和用户之间没法共享的。</p>

<p>我们都知道每一个程序都会保存一些设置数据，比如记住上次窗口的位置和大小，记住是否弹出某些提示信息等。苹果提供了一个统一的解决方案，就是每一个app都有一个plist文件专门用以保存偏好设置数据。
plist文件名默认是程序Bundle identifier,扩展名为plist.</p>

<p>除了程序自己的设置外，系统还有一些全局的或者其它的一些设置，也属于User Defaults的范畴，User Defaults的持久化数据都保存在 <code>~/Library/Preferences</code> 目录中.</p>

<p>这里有一点简要的说一下，User Defaults  中存放的key value分放在多个Domain中，取的时候按一定的次序取查找，次序如下:</p>

<ul>
<li><strong>The Argument Domain</strong>   程序启动的时候以参数的方式传入的</li>
<li><strong>The Application Domain</strong> 通过NSUserDefaults往里面写数据的时候默认就是写到这个Domain的，通过Bundle identifier来标识</li>
<li><strong>The Global Domain</strong> 用户的全局的设置（系统的偏好设置）会放在这个Domain下，比如用户的语言设置，滚动条的设置等，里面的设置会对所有的程序起作用。</li>
<li><strong>The Languages Domains</strong></li>
<li><strong>The Registration Domain</strong>  这个domain里面的key value是提供默认值的，一般会在程序启动的设置进行设置，他们都不会被持久化到文件的。当某个key对应的值在上面的那些domain中都不存在的时候，就到这里找。</li>
</ul>


<p>Mac系统还为user defaults提供了很好的命令行工具，<code>defaults</code> 你可以通过下面的方式查看具体使用方式</p>

<pre><code>man defaults
</code></pre>

<p>可以通过<code>defaults domains</code>查看当前用户的所有的domain，通过 <code>defaults read NSGlobalDomain</code> 读取 <strong>The Global Domain</strong> 中的所有值。</p>

<p> <strong>NSUserDefaults</strong> 类来读写Preferences设置，而无需考虑文件位置等细节问题。</p>

<p><strong>NSUserDefaults</strong> 用起来和 <strong>NSDictionary</strong> 很相似，多了一个Domain的概念在里面。
<strong>NSUserDefaults</strong> 一样提供了一个获取单例的方法.</p>

<pre><code>+ (NSUserDefaults *)standardUserDefaults
</code></pre>

<p>NSUserDefaults提供了一系列的接口来根据key获取对应的value，搜索的次序按照上面提及到的次序在各个Domain中进行查找。还提供了一系列的 Setting Default Values的方法，这些设置的值都是在 <strong>The Application Domain</strong> 下的.当然也提供了修改其他Domain下的值的方法，只是需要整体的设置。</p>

<h2>3.数据库</h2>

<p>Mac上自带安装了SQLite3 ,如果你之前接触过关系型数据库，你可以通过命令行来对SQLite进行初步的认识</p>

<div class="highlight"><pre><code class="bash">    
<span class="nv">$ </span>sqlite3 test.db
SQLite version 3.7.5
Enter <span class="s2">&quot;.help&quot;</span> <span class="k">for </span>instructions
Enter SQL statements terminated with a <span class="s2">&quot;;&quot;</span>
sqlite&gt;create table <span class="k">if </span>not exists names<span class="o">(</span>id integer primary key asc, name text<span class="o">)</span>; 
sqlite&gt; insert into names<span class="o">(</span>name<span class="o">)</span> values<span class="o">(</span><span class="s1">&#39;Luke&#39;</span><span class="o">)</span>;
sqlite&gt; <span class="k">select</span> * from names;
1|Luke
sqlite&gt; 
</code></pre></div>


<p>那如果在代码中使用SQLite呢？</p>

<ul>
<li>添加sqlite的动态链接库 libsqlite3.0.dylib</li>
<li>引入头文件 #import "sqlite3.h"</li>
</ul>


<p>这样之后你便可以通过C的接口来操作数据库了</p>

<div class="highlight"><pre><code class="objc">    
<span class="n">sqlite3</span> <span class="o">*</span><span class="n">database</span><span class="p">;</span><span class="c1">//sqlite3的类型其实只是一个结构体struct</span>
<span class="n">NSArray</span> <span class="o">*</span><span class="n">documentsPaths</span><span class="o">=</span><span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSDocumentDirectory</span> 
                                                         <span class="p">,</span> <span class="n">NSUserDomainMask</span> 
                                                         <span class="p">,</span> <span class="nb">YES</span><span class="p">);</span> 
<span class="n">NSString</span> <span class="o">*</span><span class="n">databaseFilePath</span><span class="o">=</span><span class="p">[[</span><span class="n">documentsPaths</span> <span class="n">objectAtIndex</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span> <span class="n">stringByAppendingPathComponent</span><span class="o">:</span><span class="s">@&quot;luke.db&quot;</span><span class="p">];</span>

<span class="c1">//打开数据库</span>
<span class="k">if</span> <span class="p">(</span><span class="n">sqlite3_open</span><span class="p">([</span><span class="n">databaseFilePath</span> <span class="n">UTF8String</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">database</span><span class="p">)</span><span class="o">==</span><span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span> 
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;open sqlite db ok.&quot;</span><span class="p">);</span> 
    <span class="kt">char</span> <span class="o">*</span><span class="n">errorMsg</span><span class="p">;</span> 
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">createSql</span><span class="o">=</span><span class="s">&quot;create table if not exists names (id integer primary key asc,name text)&quot;</span><span class="p">;</span>
    <span class="c1">//创建表</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sqlite3_exec</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">createSql</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorMsg</span><span class="p">)</span><span class="o">==</span><span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;create ok.&quot;</span><span class="p">);</span> 
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;error: %s&quot;</span><span class="p">,</span><span class="n">errorMsg</span><span class="p">);</span> 
        <span class="n">sqlite3_free</span><span class="p">(</span><span class="n">errorMsg</span><span class="p">);</span>
    <span class="p">}</span>
    
    
    <span class="c1">//插入数据</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">insertSql</span><span class="o">=</span><span class="s">&quot;insert into names (name) values(</span><span class="se">\&quot;</span><span class="s">Luke</span><span class="se">\&quot;</span><span class="s">)&quot;</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">sqlite3_exec</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">insertSql</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errorMsg</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;insert ok.&quot;</span><span class="p">);</span> 
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;error: %s&quot;</span><span class="p">,</span><span class="n">errorMsg</span><span class="p">);</span> 
        <span class="n">sqlite3_free</span><span class="p">(</span><span class="n">errorMsg</span><span class="p">);</span> 
    <span class="p">}</span>
    
    
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">selectSql</span><span class="o">=</span><span class="s">&quot;select id,name from names&quot;</span><span class="p">;</span> 
    <span class="n">sqlite3_stmt</span> <span class="o">*</span><span class="n">statement</span><span class="p">;</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">sqlite3_prepare_v2</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">selectSql</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">statement</span><span class="p">,</span> <span class="nb">nil</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span> 
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;select ok.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">sqlite3_step</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span><span class="o">==</span><span class="n">SQLITE_ROW</span><span class="p">)</span> <span class="p">{</span> 
        <span class="kt">int</span> <span class="n">_id</span><span class="o">=</span><span class="n">sqlite3_column_int</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> 
        <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">sqlite3_column_text</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> 
        <span class="n">NSString</span> <span class="o">*</span><span class="n">nameString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="n">stringWithCString</span><span class="o">:</span><span class="n">name</span> <span class="n">encoding</span><span class="o">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;row&gt;&gt;id %i, name %@&quot;</span><span class="p">,</span><span class="n">_id</span><span class="p">,</span><span class="n">nameString</span><span class="p">);</span> 
    <span class="p">}</span>
    
    <span class="n">sqlite3_finalize</span><span class="p">(</span><span class="n">statement</span><span class="p">);</span>
    
<span class="p">}</span>

<span class="n">sqlite3_close</span><span class="p">(</span><span class="n">database</span><span class="p">);</span>
</code></pre></div>


<p>你会发现这完全是C语言编程，和Objective-C的代码混在一起格格不入，也很不方便，所以便有人开发了开源的sqlite c接口的wrapper</p>

<ul>
<li>FMDB <a href="https://github.com/ccgus/fmdb">https://github.com/ccgus/fmdb</a></li>
<li>EGODatabase  <a href="https://github.com/ccgus/fmdb">https://github.com/enormego/egodatabase</a> (部分代码来自FMDB，thread safe)</li>
</ul>


<p>具体的使用方法，各自的文档都写的比较清楚。
FMDB不支持多线程同时使用同一个数据库连接进行操作，否则会有线程安全问题，有可能导致数据库文件损坏。EGODatabase则引入了多线程的支持，部分代码借鉴了FMDB，两者在使用上非常的相似。另EGODatabase提供了异步数据库操作的支持，将数据库操作封装成数据库请求（其继承于NSOperation），数据库请求创建好了，丢到一个OperationQueue中被异步的进行执行，当请求数据完成之后 ，相应的delegate方法会被调用，然后你可以在主线程更新显示了.</p>

</section>
<section class="meta">
<span class="author">
  <a href="/MyCsdn/about">海涛</a>
</span>
<span class="time">
  /
  <time datetime="2012-01-19">2012-01-19</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="/MyCsdn/categories/#programming" title="programming">programming</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="/MyCsdn/tags/#iOS" title="iOS">iOS</a>&nbsp;
  
  <a href="/MyCsdn/tags/#Objc" title="Objc">Objc</a>&nbsp;
  
</span>

</section>
<section class="comment">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'Haitao'; // required: replace example with your forum shortname
    var disqus_url = '/2012/01/ios-persistence/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = '/2012/01/block/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = '/2012/01/macios-socket/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>


        </article>
      </div>

    <footer>
        <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> | Copyright 2008 - 2013 by <a href="http://blog.csdn.net/feibuhui123">Haitao</a> | <span class="label label-info">2013-08-29 17:23:28 CST</span></small></p>
    </footer>

    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-12936429-2']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
